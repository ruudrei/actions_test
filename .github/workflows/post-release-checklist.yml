name: Post release checklist

on:
    release:
        types: [published]

jobs:
    update_discussion:
        # リリースタグが v / backend_v / learning_v のときのみ実行
        if: >-
            startsWith(github.event.release.tag_name, 'v') ||
            startsWith(github.event.release.tag_name, 'backend_v') ||
            startsWith(github.event.release.tag_name, 'learning_v')
        runs-on: ubuntu-latest
        permissions:
            discussions: write
            contents: read

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Update discussion table
              env:
                  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
                  REPO: ${{ github.repository }}
                  TITLE: ${{ github.event.release.name }}
                  RELEASE_TAG: ${{ github.event.release.tag_name }}
                  DISCUSSION_TITLE: "リリース反映チェックリスト"
                  CUSTOMERS_CSV: "株式会社A,株式会社B,株式会社C"
              run: |
                  bash scripts/update_discussion_table.sh
